%-------------------------------%
%  Author: Alessandro Sciarra   %
%    Date: 8 Jul 2019           %
%-------------------------------%

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
\begin{frame}[fragile]{The \,\bash|case|\, keyword}
    \vspace{-3mm}
    Completely equivalent to a \bash|if-elif-else-fi| construct, but often handy:
    \medskip
    \begin{lstlisting}[style=MyBash, numbers=none, belowskip=-5mm]
        case WORD in
            |+[ [(] pattern [| pattern]...) command-list ;;]...+|
        esac
    \end{lstlisting}
    \begin{overlayarea}{\textwidth}{\textheight}
    
        \begin{onlyenv}<1>
            \begin{itemize}
                \setlength{\itemsep}{0mm}
                \item The command-list corresponding to the first pattern that matches word is executed
                \item The match is performed according \PP{Pattern Matching} rules
                \item The \bash{|} is used to separate multiple patterns
                \item The \bash|)| operator terminates a pattern list
                \item A list of patterns and an associated command-list is known as a \textbf{clause}
            \end{itemize}
            \vspace{-5mm}
            \begin{center}
                \alert{\textbf{Before matching is attempted:}}\\[0.3em]
                \tikzmark{wordStart}tilde expansion\tikzmark{patternStart}\\
                parameter expansion\\
                command substitution\\
                arithmetic expansion\tikzmark{patternEnd}\\
                \tikzmark{wordEnd}quote removal
            \end{center}
        \end{onlyenv}
        \begin{tikzpicture}[remember picture, overlay, PP]
            \begin{scope}[scope on=<1>]
                \draw[very thick, decorate, decoration={brace,amplitude=6pt}] (patternStart -| patternEnd) ++(5mm,1mm) -- ($(patternEnd)+(5mm,-1mm)$)
                          node[midway, right=3mm, text width=18mm, align=center] {Pattern under-goes};
                \draw[very thick, decorate, decoration={brace,amplitude=6pt}] (wordEnd  -| wordStart) ++(-8mm,-1mm) -- ($(wordStart)+(-8mm,1mm)$)
                          node[midway, left=3mm, text width=18mm, align=center] {\texttt{WORD} under-goes};
            \end{scope}
        \end{tikzpicture}
        \begin{onlyenv}<2>
            \vspace{-3mm}
            \begin{lstlisting}[style=MyBash]
                case $LANG in
                    en* )
                        echo 'Hello!' ;;
                    fr* )
                        echo 'Salut!' ;;
                    de* )
                        echo 'Hallo!' ;;
                    it* )
                        echo 'Ciao!' ;;
                    es* )
                        echo 'Hola!' ;;
                    C | POSIX )
                        echo 'Hello World!' ;;
                    *)
                        echo 'I do not speak your language.' ;;
                esac
            \end{lstlisting}
        \end{onlyenv}
    \end{overlayarea}
    \FrameRemark{Using \bash|;&| or \bash|;;&| instead of \bash|;;| allows to execute the command list or to test the patterns of the next clause, respectively.}
\end{frame}